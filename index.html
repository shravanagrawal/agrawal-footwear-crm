<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Agrawal Footwear CRM + Inventory</title>

<!-- jsPDF for PDF generation -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<!-- QRCode.js for generating QR codes -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
  :root { --bg:#0f1220; --fg:#e8ecf1; --muted:#a8b0c2; --card:#171a2b; --accent:#5bd1ff; --danger:#ff6b6b; --ok:#79d88a; --border:#2a2f48; }
  * { box-sizing:border-box; }
  body { margin:0; font-family: ui-sans-serif, system-ui, "Segoe UI", Roboto, Arial; background:var(--bg); color:var(--fg); }
  header { display:flex; align-items:center; justify-content:space-between; padding:12px 16px; border-bottom:1px solid var(--border); position:sticky; top:0; background:var(--bg); z-index:10; }
  .brand { display:flex; align-items:center; gap:10px; }
  .brand h1 { font-size:16px; margin:0; font-weight:600; letter-spacing:0.3px; }
  nav a { color:var(--muted); margin:0 8px; text-decoration:none; }
  nav a.active { color:var(--accent); font-weight:600; }
  main { max-width:1100px; margin: 16px auto; padding: 0 16px; }
  .card { background:var(--card); border:1px solid var(--border); border-radius:10px; padding:16px; margin:12px 0; }
  .grid { display:grid; gap:12px; }
  .cols-2 { grid-template-columns:1fr 1fr; }
  .cols-3 { grid-template-columns:1fr 1fr 1fr; }
  .cols-4 { grid-template-columns:repeat(4,1fr); }
  .row { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
  label { display:block; font-size:12px; color:var(--muted); margin-bottom:6px; }
  input, select, textarea, button { background:#121528; border:1px solid var(--border); color:var(--fg); border-radius:8px; padding:10px; font-size:14px; }
  button { cursor:pointer; }
  button.primary { background:linear-gradient(90deg,#5bd1ff,#7ef8d7); color:#04121a; border:none; font-weight:600; }
  button.ghost { background:transparent; border:1px solid var(--border); }
  table { width:100%; border-collapse:collapse; margin-top:8px; }
  th, td { border-bottom:1px solid #27304b; padding:10px; text-align:left; font-size:14px; }
  th { color:#9fb1c9; font-weight:600; }
  .pill { display:inline-block; padding:4px 8px; border-radius:999px; font-size:12px; color:#0c1a26; }
  .pill.ok { background:var(--ok); }
  .pill.warn { background:#ffcf6b; }
  .pill.bad { background:var(--danger); color:#fff; }
  footer { padding:16px; text-align:center; color:var(--muted); }
  .signature { margin-top:6px; font-style:italic; color:var(--accent); text-align:center; }
</style>
</head>
<body>
<header>
  <div class="brand">
    <!-- Inline Agrawal Footwear Logo -->
    <svg width="160" height="56" viewBox="0 0 400 120" xmlns="http://www.w3.org/2000/svg">
      <path d="M20 80 C60 20, 140 20, 200 80 Q220 100, 260 80 T380 80" fill="none" stroke="#5bd1ff" stroke-width="8" stroke-linecap="round"/>
      <line x1="20" y1="85" x2="380" y2="85" stroke="#79d88a" stroke-width="6" stroke-linecap="round"/>
      <text x="200" y="110" font-family="Segoe UI, sans-serif" font-size="28" text-anchor="middle" fill="#e8ecf1" font-weight="bold">Agrawal Footwear</text>
    </svg>
    <div>
      <h1>CRM + Inventory</h1>
      <div class="signature">Developed and managed By Shravan Agrawal</div>
    </div>
  </div>
  <nav id="nav"></nav>
</header>

<main id="app"></main>
<footer>
  Local-first. Offline-ready. IndexedDB storage. Single-file. Installable (PWA).
  <div class="signature">Developed and managed By Shravan Agrawal</div>
</footer>

<script>
// ... (all your existing DB, Auth, Svc, Views, Actions code remains unchanged)

// Extend Actions with PDF generation
Actions.downloadInvoicePDF = async function(invId){
  try {
    const { jsPDF } = window.jspdf;
    const inv = await Svc.listInvoices().then(list => list.find(i=>i.id===invId));
    if(!inv) throw new Error("Invoice not found");
    const so = await Svc.listSalesOrders().then(list => list.find(s=>s.id===inv.soId));
    const acc = await Svc.listAccounts().then(list => list.find(a=>a.id===so.accountId));
    const lines = so.lines || [];

    const doc = new jsPDF();

    // Shop header
    doc.setFontSize(16);
    doc.text("Agrawal Footwear", 20, 20);
    doc.setFontSize(12);
    doc.text("Main Market, Birsinghpur, Satna, Madhya Pradesh 485226", 20, 28);

    // Customer details
    doc.setFontSize(14);
    doc.text("Invoice: " + inv.id.slice(0,8), 20, 40);
    doc.text("Customer: " + (acc?.name || "Unknown"), 20, 48);

    // Items
    let y = 60;
    doc.setFontSize(12);
    doc.text("Items:", 20, y);
    y += 8;
    lines.forEach(l=>{
      doc.text(`${l.qty} x ${l.price} = ${l.qty*l.price}`, 25, y);
      y += 8;
    });
    doc.text("Total: " + inv.total, 20, y+10);

    // QR code
    const qrData = `
      Shop: Agrawal Footwear
      Address: Main Market, Birsinghpur, Satna, Madhya Pradesh 485226
      Invoice: ${inv.id}
      Customer: ${acc?.name||""}
      Total: ${inv.total}
    `;
    const qrDiv = document.createElement("div");
    new QRCode(qrDiv, { text: qrData, width: 128, height: 128 });
    const qrCanvas = qrDiv.querySelector("canvas");
    const qrDataUrl = qrCanvas.toDataURL("image/png");
    doc.addImage(qrDataUrl, "PNG", 150, 40, 50, 50);

    doc.save(`Invoice_${inv.id.slice(0,8)}.pdf`);
  } catch(e){
    UI.notify(e.message,"bad");
  }
};

// In Views.sales(), add Download PDF button for each invoice row
// Example snippet inside invoice table row:
{/* <button class="ghost" onclick="Actions.downloadInvoicePDF('${inv.id}')">Download PDF</button> */}

</script>
</body>
</html>
